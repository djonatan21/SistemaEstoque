unit UnTypesGeral;

interface

uses
  UnFormLogin, Vcl.Controls, Vcl.Dialogs, System.SysUtils;

type
  CGeralTypes = Record
    CUsuarioLogado: string;
  End;

  GTypeGeral = class
    class procedure ExcluirItem;
    class Procedure SubTotalVenda;
    class Function CarregarProximoID(ASqlColuna, ANomeTabela: string): integer;
    class Function AtualizarSaldo(AColuna, ANomeTabela: string): Extended;
    class procedure SetFocusCampo(ASender: TObject; AControle: TWinControl);
    class function ValidarCampoNumerico(ASender: TObject;
      AControle: TWinControl; AText, ANomeCampoMessage: String): String;
  end;

implementation

uses
  UnFormMenuPrincipal, UnDmValidacoesTypesGeral;

class function GTypeGeral.AtualizarSaldo(AColuna, ANomeTabela: string)
  : Extended;
begin
  with DmValidar.SQLValidar do
  begin
    Close;
    SQL.Clear;
    SQL.Add('SELECT COALESCE(SUM(' + AColuna + '),0) AS RESULT');
    SQL.Add('FROM ' + ANomeTabela);
    Open();
    Result := Fields[0].value;
  end;
end;

class function GTypeGeral.CarregarProximoID(ASqlColuna,
  ANomeTabela: string): integer;
begin
  try
    with DmValidar.SQLValidar do
    begin
      Close;
      SQL.Clear;
      SQL.Add('SELECT COALESCE(MAX(' + ASqlColuna + '),0) AS RESULT');
      SQL.Add('FROM ' + ANomeTabela);
      Open();
      Result := Fields[0].value + 1;
    end;
  except
    Result := 0;
  end;
end;

class procedure GTypeGeral.ExcluirItem;
begin

end;

class procedure GTypeGeral.SetFocusCampo(ASender: TObject;
  AControle: TWinControl);
begin
  if ASender <> nil then
  begin
    if AControle.CanFocus then
      AControle.SetFocus;
  end;
end;

class procedure GTypeGeral.SubTotalVenda;
begin

end;

class function GTypeGeral.ValidarCampoNumerico(ASender: TObject;
  AControle: TWinControl; AText, ANomeCampoMessage: String): String;
var
  I: integer;
begin
  if ASender = nil then
  begin
    if AText <> '' then
    begin
      for I := 0 to AText.Length do
      begin
        if not(StrToIntDef(AText[I], 11) >= 0) and
          not(StrToIntDef(AText[I], 11) <= 9) then
          AText[I] := '';
      end;
    end;
  end;
end;

end.
